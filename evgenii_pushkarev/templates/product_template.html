{% extends "base.html" %}

{% block title %}{{ product.name }} - RetroArcade{% endblock %}

{% block content %}
<!-- ОСНОВНАЯ ИНФОРМАЦИЯ О ТОВАРЕ -->
<div class="product-detail">
    <!-- ЛЕВАЯ КОЛОНКА - ИЗОБРАЖЕНИЕ -->
    <div class="product-image-large">
        {% if product.image %}
            <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product.name }}"
                 onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80';">
        {% else %}
            <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; color: var(--gray);">
                <i class="fas fa-gamepad" style="font-size: 3rem;"></i>
            </div>
        {% endif %}
    </div>

    <!-- ПРАВАЯ КОЛОНКА - ИНФОРМАЦИЯ -->
    <div class="product-info-card">
        <h1 class="product-title-large">{{ product.name }}</h1>
        <div class="product-price-large">{{ product.price }} ₽</div>
        <div class="status-badge">✅ В наличии</div>

        <p class="product-description-large">
            {{ product.description }}
        </p>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="addToCart()">
                <i class="fas fa-cart-plus"></i> Добавить в корзину
            </button>
            <button class="btn btn-outline" onclick="toggleFavorite()">
                <i class="far fa-heart"></i> В избранное
            </button>
            <a href="{{ url_for('add_to_compare_route', product_id=product.id) }}" class="btn btn-primary">
                <i class="fas fa-balance-scale"></i> В сравнение
            </a>
        </div>
    </div>

    <!-- ХАРАКТЕРИСТИКИ -->
    <div class="specs-section">
        <h2 class="section-title">Технические характеристики</h2>
        <div class="specs-grid">
            <div class="spec-item">
                <div class="spec-label">Производитель</div>
                <div class="spec-value">{{ product.manufacturer }}</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Год выпуска</div>
                <div class="spec-value">{{ product.year }}</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Состояние</div>
                <div class="spec-value">Отличное</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Габариты</div>
                <div class="spec-value">{{ product.dimensions }}</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Вес</div>
                <div class="spec-value">{{ product.weight }}</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Напряжение</div>
                <div class="spec-value">{{ product.voltage }}</div>
            </div>
            <div class="spec-item">
                <div class="spec-label">Экран</div>
                <div class="spec-value">{{ product.screen }}</div>
            </div>
            {% if product.components %}
            <div class="spec-item">
                <div class="spec-label">Комплектующие</div>
                <div class="spec-value">{{ product.components }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- ДОСТАВКА И ОПЛАТА -->
    <div class="delivery-info">
        <h2 class="section-title">Доставка и оплата</h2>
        <div class="delivery-item">
            <div class="delivery-icon">
                <i class="fas fa-shipping-fast"></i>
            </div>
            <div class="delivery-text">Доставка по России - 3-7 дней</div>
        </div>
        <div class="delivery-item">
            <div class="delivery-icon">
                <i class="fas fa-credit-card"></i>
            </div>
            <div class="delivery-text">Оплата при получении или онлайн</div>
        </div>
        <div class="delivery-item">
            <div class="delivery-icon">
                <i class="fas fa-tools"></i>
            </div>
            <div class="delivery-text">Бесплатная установка и настройка</div>
        </div>
        <div class="delivery-item">
            <div class="delivery-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div class="delivery-text">Гарантия 12 месяцев</div>
        </div>
        <div class="delivery-item">
            <div class="delivery-icon">
                <i class="fas fa-headset"></i>
            </div>
            <div class="delivery-text">Техническая поддержка 24/7</div>
        </div>
    </div>
</div>

<!-- ОТЗЫВЫ -->
<div class="reviews-section">
    <h2 class="section-title">Отзывы покупателей</h2>

    <div class="reviews-grid">
        <div class="review-card">
            <div class="review-header">
                <span class="review-author">Алексей В.</span>
                <span class="review-rating">★★★★★</span>
            </div>
            <p class="review-text">Отличное состояние, доставка быстрая. Автомат работает как новый, очень доволен покупкой! Особенно порадовала бесплатная установка.</p>
        </div>

        <div class="review-card">
            <div class="review-header">
                <span class="review-author">Мария К.</span>
                <span class="review-rating">★★★★☆</span>
            </div>
            <p class="review-text">Небольшие косметические дефекты, но в целом соответствует описанию. Спасибо за честность! Звук работает отлично, экран яркий.</p>
        </div>

        <div class="review-card">
            <div class="review-header">
                <span class="review-author">Дмитрий П.</span>
                <span class="review-rating">★★★★★</span>
            </div>
            <p class="review-text">Мечта детства сбылась! Качество на высоте, обслуживание отличное. Рекомендую этот магазин всем коллекционерам.</p>
        </div>

        <div class="review-card">
            <div class="review-header">
                <span class="review-author">Сергей И.</span>
                <span class="review-rating">★★★★★</span>
            </div>
            <p class="review-text">Покупал для игрового клуба. Автомат работает без нареканий, клиенты в восторге. Отдельное спасибо за гарантийное обслуживание.</p>
        </div>
    </div>
</div>

<!-- ПОХОЖИЕ ТОВАРЫ -->
<div class="similar-products">
    <h2 class="section-title">Рекомендуемые товары</h2>

    <div class="products-grid">
        {% for similar_product in similar_products %}
            <div class="product-card">
                <div class="product-badge {{ 'hot' if loop.index == 1 else 'new' if loop.index == 2 else 'discount' }}">
                    {{ 'Хит' if loop.index == 1 else 'Новинка' if loop.index == 2 else 'Скидка' }}
                </div>

                <a href="{{ url_for('product_page', product_id=similar_product.id) }}">
                    <div class="product-image">
                        <img src="{{ url_for('static', filename=similar_product.image) }}"
                             alt="{{ similar_product.name }}"
                             onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80';">
                    </div>
                </a>

                <div class="product-info">
                    <a href="{{ url_for('product_page', product_id=similar_product.id) }}" style="text-decoration: none;">
                        <h3 class="product-title">{{ similar_product.name }}</h3>
                    </a>
                    <div class="product-category">
                        <i class="fas fa-tag"></i> {{ similar_product.category_name }}
                    </div>
                    <p class="product-description">
                        {{ similar_product.description[:80] }}...
                    </p>
                    <div class="product-footer">
                        <div class="product-price">{{ similar_product.price }} ₽</div>
                        <div class="product-actions">
                            <button class="action-btn" title="В корзину" onclick="addSimilarToCart('{{ similar_product.id }}')">
                                <i class="fas fa-cart-plus"></i>
                            </button>
                            <button class="action-btn" title="Избранное" onclick="toggleFavorite('{{ similar_product.id }}')">
                                <i class="far fa-heart"></i>
                            </button>
                            <a href="{{ url_for('add_to_compare_route', product_id=similar_product.id) }}" class="action-btn" title="В сравнение">
                                <i class="fas fa-balance-scale"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <a href="{{ url_for('index') }}" class="view-all-btn">
        <i class="fas fa-gamepad"></i> Смотреть все автоматы
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Добавление в корзину (основной товар)
    function addToCart() {
        alert('Товар добавлен в корзину!');
        const cartCount = document.querySelector('.cart-count');
        let count = parseInt(cartCount.textContent);
        cartCount.textContent = count + 1;
    }

    // Добавление в корзину (рекомендуемые товары)
    function addSimilarToCart(productId) {
        alert('Товар добавлен в корзину!');
        const cartCount = document.querySelector('.cart-count');
        let count = parseInt(cartCount.textContent);
        cartCount.textContent = count + 1;

        // Анимация кнопки
        const btn = event.currentTarget;
        const originalColor = btn.style.backgroundColor;
        btn.style.backgroundColor = 'var(--success)';
        btn.style.color = 'white';
        setTimeout(() => {
            btn.style.backgroundColor = originalColor;
            btn.style.color = '';
        }, 500);
    }

    // Добавление в избранное (основной товар)
    function toggleFavorite() {
        const button = event.currentTarget;
        const icon = button.querySelector('i');

        if (icon.classList.contains('far')) {
            icon.classList.remove('far');
            icon.classList.add('fas');
            icon.style.color = '#dc3545';
            alert('Товар добавлен в избранное!');
        } else {
            icon.classList.remove('fas');
            icon.classList.add('far');
            icon.style.color = '';
            alert('Товар удален из избранного!');
        }
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Страница товара загружена');
        console.log('current_user:', '{{ current_user }}');
        console.log('compare_count:', {{ compare_count }});
    });
</script>
{% endblock %}