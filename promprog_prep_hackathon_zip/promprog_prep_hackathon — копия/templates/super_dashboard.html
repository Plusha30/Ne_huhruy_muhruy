{% extends "base.html" %}
{% block title %}Ultimate Data Hub 2026{% endblock %}

{% block content %}
<div class="container-fluid px-4 pb-5">
    
    <!-- HEADER SECTION: Минимизированы внешние запросы -->
    <div class="d-flex flex-wrap justify-content-between align-items-end mb-4 gap-3">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item small text-muted">Analytics</li>
                    <li class="breadcrumb-item small active">Performance</li>
                </ol>
            </nav>
            <h2 class="fw-bold mb-0">Platform <span class="text-gradient">Intelligence</span></h2>
        </div>
        <div class="d-flex align-items-center gap-3 bg-white p-2 px-3 rounded-pill shadow-sm border">
            <div class="position-relative">
                <span class="d-inline-block p-1 bg-success border border-light rounded-circle"></span>
            </div>
            <span class="small fw-bold text-secondary">System Online: <span class="text-dark" id="live-timer">17:19:00</span></span>
        </div>
    </div>

    <!-- ROW 1: МЕТРИКИ (Без изменений дизайна, но оптимизированы тени) -->
    <div class="row g-4 mb-4">
        {% set metrics = [
            {'label': 'Revenue', 'val': '$84,200', 'icon': 'wallet2', 'c': 'primary'},
            {'label': 'Active', 'val': '1,429', 'icon': 'person-badge', 'c': 'success'},
            {'label': 'Load', 'val': '32.1%', 'icon': 'cpu', 'c': 'warning'},
            {'label': 'Latency', 'val': '124ms', 'icon': 'speedometer', 'c': 'info'}
        ] %}
        {% for m in metrics %}
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm p-3 h-100">
                <div class="d-flex justify-content-between mb-3">
                    <div class="bg-{{m.c}} bg-opacity-10 text-{{m.c}} rounded-3 p-2 px-3">
                        <i class="bi bi-{{m.icon}}"></i>
                    </div>
                </div>
                <h6 class="text-muted small fw-bold text-uppercase mb-1">{{ m.label }}</h6>
                <h3 class="fw-bold mb-0">{{ m.val }}</h3>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- ROW 2: ГРАФИКИ (ОТКЛЮЧЕНА АНИМАЦИЯ ДЛЯ СКОРОСТИ) -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm p-4 h-100">
                <div class="d-flex justify-content-between mb-4">
                    <h5 class="fw-bold mb-0">Performance Analytics</h5>
                    <span class="badge bg-light text-dark rounded-pill border">Jan 2026</span>
                </div>
                <div style="height: 300px; position: relative;">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm p-4 h-100 text-center">
                <h5 class="fw-bold mb-4">Traffic</h5>
                <div style="height: 220px; position: relative;">
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="mt-4">
                    <div class="small d-flex justify-content-between"><span>Desktop</span><span class="fw-bold">58%</span></div>
                    <div class="small d-flex justify-content-between"><span>Mobile</span><span class="fw-bold">42%</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ROW 3: ТАБЛИЦА (УБРАНЫ ВНЕШНИЕ КАРТИНКИ) -->
    <div class="row g-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm overflow-hidden">
                <div class="table-responsive">
                    <table class="table align-middle table-hover mb-0">
                        <thead class="bg-light">
                            <tr class="small text-muted fw-bold">
                                <th class="ps-4">SERVICE</th>
                                <th>HEALTH</th>
                                <th>TEAM</th>
                                <th class="text-end pe-4">ACTION</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for s in [{'n': 'Core-API', 'c': 'success'}, {'n': 'Auth-Module', 'c': 'warning'}, {'n': 'Payments', 'c': 'success'}] %}
                            <tr>
                                <td class="ps-4">
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="bg-dark rounded-2 p-2 text-white"><i class="bi bi-cpu" style="font-size: 0.8rem;"></i></div>
                                        <span class="fw-bold small">{{ s.n }}</span>
                                    </div>
                                </td>
                                <td><span class="badge bg-{{s.c}} bg-opacity-10 text-{{s.c}} rounded-pill">● Online</span></td>
                                <td>
                                    <!-- ЗАМЕНА ТЯЖЕЛЫХ КАРТИНОК НА ЛЕГКИЕ ИКОНКИ -->
                                    <div class="d-flex">
                                        <div class="bg-primary text-white rounded-circle border border-2 border-white d-flex align-items-center justify-content-center small" style="width: 28px; height: 28px; font-size: 10px;">AD</div>
                                        <div class="bg-info text-white rounded-circle border border-2 border-white d-flex align-items-center justify-content-center small" style="width: 28px; height: 28px; font-size: 10px; margin-left: -10px;">RU</div>
                                    </div>
                                </td>
                                <td class="text-end pe-4"><button class="btn btn-sm btn-light border rounded-pill px-3">Manage</button></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Убираем тяжелые эффекты размытия, оставляем чистый рендеринг */
    .card { transition: none; } /* Отключаем транзиции для мгновенного отклика */
    .text-gradient { background: linear-gradient(45deg, #0d6efd, #0dcaf0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .skeleton { background: #f0f2f5; height: 20px; border-radius: 4px; }
</style>

<script src="https://cdn.jsdelivr.net"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Настройки для МГНОВЕННОЙ отрисовки
    const fastOptions = {
        animation: false, // ГЛАВНЫЙ ФИКС: отключает анимацию
        responsive: true,
        maintainAspectRatio: false,
        elements: { line: { tension: 0.4 } },
        plugins: { legend: { display: false } },
        scales: {
            y: { beginAtZero: true, grid: { display: false } },
            x: { grid: { display: false } }
        }
    };

    const ctxMain = document.getElementById('mainChart').getContext('2d');
    new Chart(ctxMain, {
        type: 'line',
        data: {
            labels: ['16', '17', '18', '19', '20', '21', '22'],
            datasets: [{
                data:,
                borderColor: '#0d6efd',
                borderWidth: 2,
                pointRadius: 0,
                fill: false
            }]
        },
        options: fastOptions
    });

    const ctxPie = document.getElementById('pieChart').getContext('2d');
    new Chart(ctxPie, {
        type: 'doughnut',
        data: {
            labels: ['D', 'M'],
            datasets: [{
                data:,
                backgroundColor: ['#0d6efd', '#0dcaf0'],
                borderWidth: 0
            }]
        },
        options: { ...fastOptions, cutout: '80%' }
    });

    // Легкий таймер
    const timeEl = document.getElementById('live-timer');
    setInterval(() => {
        const d = new Date();
        timeEl.textContent = d.getHours() + ':' + d.getMinutes().toString().padStart(2, '0') + ':' + d.getSeconds().toString().padStart(2, '0');
    }, 1000);
});
</script>
{% endblock %}