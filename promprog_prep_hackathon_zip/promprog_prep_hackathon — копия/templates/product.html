{% extends "base.html" %}
{% block title %}{{ product.name }} - –ú–µ–Ω—é{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}"
                    class="text-decoration-none text-muted">–ú–µ–Ω—é</a></li>
            <li class="breadcrumb-item active">{{ product.name }}</li>
        </ol>
    </nav>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ -->
    <div class="row g-5 mb-5">
        <div class="col-lg-6">
            <div class="bg-white rounded-4 border p-5 d-flex align-items-center justify-content-center shadow-sm"
                style="height: 400px;">
                <i class="bi {{ product.main_icon }}" style="font-size: 10rem; color: {{ product.color }};"></i>
            </div>
        </div>
        <div class="col-lg-6">
            <h1 class="fw-bold">{{ product.name }}</h1>
            <h2 class="text-primary fw-bold mb-3">{{ product.price }} ‚ÇΩ</h2>
            <p class="lead text-secondary">{{ product.description }}</p>

            {% if rights == 1 %}
            <button class="btn btn-primary-custom btn-pill px-5 py-3 shadow-sm">–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑</button>
            {% elif rights == 0 %}
            <a href="{{ url_for('login') }}" class="btn btn-outline-primary btn-pill px-4">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–∫–∞–∑–∞—Ç—å</a>
            {% endif %}
        </div>
    </div>

    <!-- –¢–ê–ë–´ -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <ul class="nav nav-tabs card-header-tabs" role="tablist">
                        <li class="nav-item">
                            <button class="nav-link text-muted" data-bs-toggle="tab"
                                data-bs-target="#specs">–ö–ë–ñ–£</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link active fw-bold text-dark" data-bs-toggle="tab"
                                data-bs-target="#reviews">–û—Ç–∑—ã–≤—ã</button>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-4">
                    <div class="tab-content">
                        <!-- –ö–ë–ñ–£ -->
                        <div class="tab-pane fade" id="specs">
                            <table class="table table-striped w-50">
                                <tbody>
                                    {% for key, value in product.specs.items() %}
                                    <tr>
                                        <td class="fw-bold">{{ key }}</td>
                                        <td>{{ value }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- –û–¢–ó–´–í–´ -->
                        <div class="tab-pane fade show active" id="reviews">

                            <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ (–í–∏–¥—è—Ç –≤—Å–µ) -->
                            <div id="reviewsList" class="mb-5">
                                {% for review in product.reviews %}
                                <div class="mb-4 border-bottom pb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <h6 class="fw-bold mb-0">{{ review.user }}</h6>
                                        <div class="text-warning small">
                                            {% for i in range(0, review.stars) %}
                                                <i class="bi bi-star-fill"></i>
                                            {% endfor %}
                                            {% for i in range(review.stars, 5) %}
                                                <i class="bi bi-star"></i>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <p class="text-muted small mb-0">{{ review.text }}</p>
                                </div>
                                {% endfor %}
                            </div>

                            <!-- –§–û–†–ú–ê –û–¢–ó–´–í–ê (–¢–û–õ–¨–ö–û –î–õ–Ø –£–ß–ï–ù–ò–ö–ê rights == 1) -->
                            {% if rights == 1 %}
                            <div class="bg-light p-4 rounded-3 border">
                                <h5 class="fw-bold mb-3">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h5>
                                <form id="reviewForm" method="post" action="#">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞</label>
                                        <div class="rating-input text-warning fs-4 cursor-pointer">
                                            <i class="bi bi-star" onclick="rate(1)"></i>
                                            <i class="bi bi-star" onclick="rate(2)"></i>
                                            <i class="bi bi-star" onclick="rate(3)"></i>
                                            <i class="bi bi-star" onclick="rate(4)"></i>
                                            <i class="bi bi-star" onclick="rate(5)"></i>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                                        <textarea name="commentary" id="reviewText" class="form-control rounded-3"
                                            rows="3" placeholder="–í–∫—É—Å–Ω–æ –∏–ª–∏ –Ω–µ—Ç?" required></textarea>
                                    </div>
                                    <input type="hidden" id="stars" name="stars" value=5>
                                    <button type="submit" class="btn btn-primary-custom btn-pill">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                </form>
                            </div>
                            {% else %}
                            <div class="text-muted small">
                                üîí –¢–æ–ª—å–∫–æ —É—á–µ–Ω–∏–∫–∏ –º–æ–≥—É—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã –æ –±–ª—é–¥–∞—Ö.
                            </div>
                            {% endif %}
                            <!-- –ö–æ–Ω–µ—Ü –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ -->

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var globstars = 5;
    function rate(stars) {
        const icons = document.querySelectorAll('.rating-input i');
        globstars = stars;
        icons.forEach((icon, index) => {
            if (index < stars) {
                icon.classList.remove('bi-star');
                icon.classList.add('bi-star-fill');
            } else {
                icon.classList.remove('bi-star-fill');
                icon.classList.add('bi-star');
            }
        });
    }
    document.getElementById('reviewForm').addEventListener('submit', function (e) {
        document.getElementById('stars').value = globstars;
    });
</script>
{% endblock %}